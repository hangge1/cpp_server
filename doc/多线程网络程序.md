**服务端模型:** 

**1 单线程处理N客户端**

<img src="%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BD%91%E7%BB%9C%E7%A8%8B%E5%BA%8F/image-20250214220346604.png" alt="image-20250214220346604" style="zoom:50%;" />

**2 多进程多端口分组处理N客户端**

![image-20250214220516186](%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BD%91%E7%BB%9C%E7%A8%8B%E5%BA%8F/image-20250214220516186.png)

**优点:** 单线程开发简单, 部署成本低(多台低性能机器分布式部署), 宕机影响小

**缺点:** 进程间通信较复杂, 开销大



**3 多线程单端口分组处理N客户端**

<img src="%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BD%91%E7%BB%9C%E7%A8%8B%E5%BA%8F/image-20250214220859107.png" alt="image-20250214220859107" style="zoom:50%;" />

**优点:** 线程间数据通信容易, 部署成本高(单机高性能机器)

**缺点:** 一处异常, 全部崩溃



**4 多进程多线程多端口分组处理N客户端**

![image-20250214221244847](%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BD%91%E7%BB%9C%E7%A8%8B%E5%BA%8F/image-20250214221244847.png)





**本节主要讲解:** 多线程分组处理N客户端模型

服务端逻辑图: 

1 主线程负责连接客户端

2 子线程负责对已连接的一组客户端负责收发数据

![image-20250214221502922](%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BD%91%E7%BB%9C%E7%A8%8B%E5%BA%8F/image-20250214221502922.png)



**使用多线程的目的和常见应用场景?**

1 提高硬件性能利用率

2 后台耗时任务运算(加载文件, 耗时运算)

3 并行计算(音频, 视频, 图片, AI)



**使用多线程需要注意哪些问题?**

操作共享数据时, 需要保护



**有哪些数据保护的方式呢?** 

1 加锁(互斥锁, 读写锁, 递归锁)

2 原子操作



**互斥和同步有什么区别?** 

互斥表示不能同时访问某一资源,  多个线程由OS调度, 抢占资源访问

同步表示多个线程构成先后等待关系, 共同完成任务



**使用锁需要注意点的有哪些?** 

1 锁的粒度

2 RAII管理, 防止忘记解锁





**性能测试测试用例设计:** 

N个客户端连接, 每次发送M字节大小的包, 每次连续发送K次





**客户端多线程改造:** 

提高发送频率, 模拟大规模客户端并发

<img src="%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BD%91%E7%BB%9C%E7%A8%8B%E5%BA%8F/image-20250214231347960.png" alt="image-20250214231347960" style="zoom:50%;" />

















